<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running a Laravel Website on a Test Server</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #333;
        }
        pre {
            background: #eee;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
        }
        ul {
            list-style-type: disc;
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        .note {
            background-color: #e6f7ff;
            border-left: 4px solid #2196F3;
            padding: 10px;
            margin: 15px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Notes on Running a Laravel Website on a Test Server</h1>

    <div class="note">
        <p><strong>Disclaimer:</strong> These notes assume you have a basic understanding of server administration, SSH, and the command line. This guide is for a typical Linux-based server environment (e.g., Ubuntu, CentOS).</p>
    </div>

    <h2>Step 1: Server Setup (Prerequisites)</h2>
    <p>Ensure your test server has the following software installed and configured:</p>
    <ul>
        <li><strong>Web Server:</strong> Apache or Nginx.</li>
        <li><strong>PHP:</strong> Version 8.0 or higher is recommended for modern Laravel versions.</li>
        <li><strong>Database:</strong> MySQL, PostgreSQL, or another compatible database.</li>
        <li><strong>Composer:</strong> The dependency manager for PHP.</li>
        <li><strong>Git:</strong> For version control.</li>
    </ul>
    <p>You may also need to configure a few PHP extensions, such as:</p>
    <ul>
        <li><code>php-bcmath</code></li>
        <li><code>php-ctype</code></li>
        <li><code>php-fileinfo</code></li>
        <li><code>php-mbstring</code></li>
        <li><code>php-tokenizer</code></li>
        <li><code>php-xml</code></li>
    </ul>

    <h2>Step 2: Transferring the Project</h2>
    <p>There are a few ways to get your Laravel project onto the server:</p>
    <h3>Option A: Using Git (Recommended)</h3>
    <ol>
        <li>Log in to your server via SSH.</li>
        <li>Navigate to the directory where you want to store your project (e.g., <code>/var/www/</code>).</li>
        <li>Clone your repository from a service like GitHub, GitLab, or Bitbucket.</li>
        <pre><code>git clone your_repo_url.git</code></pre>
        <li>Navigate into the new project directory.</li>
        <pre><code>cd your_project_name</code></pre>
    </ol>
    <h3>Option B: Manual File Transfer (Less Recommended for production)</h3>
    <p>Use an SFTP client like FileZilla or an SCP command to transfer the entire project folder to your server.</p>

    <h2>Step 3: Configuration and Dependencies</h2>
    <ol>
        <li><strong>Install Composer Dependencies:</strong></li>
        <p>Once inside your project directory, install the required packages.</p>
        <pre><code>composer install --no-dev --optimize-autoloader</code></pre>
        <p>The <code>--no-dev</code> flag is crucial for a test/production environment to avoid installing development-only packages.</p>

        <li><strong>Set Up Environment File:</strong></li>
        <p>Copy the example environment file and open it for editing.</p>
        <pre><code>cp .env.example .env</code></pre>
        <p>Edit the <code>.env</code> file to configure your database connection, application URL, and other settings.</p>
        <pre><code>nano .env</code></pre>
        <p>Update the following variables at a minimum:</p>
        <ul>
            <li><code>APP_URL=http://your_test_domain.com</code></li>
            <li><code>DB_DATABASE=your_database_name</code></li>
            <li><code>DB_USERNAME=your_database_user</code></li>
            <li><code>DB_PASSWORD=your_database_password</code></li>
        </ul>

        <li><strong>Generate Application Key:</strong></li>
        <p>This is a critical security step. If you cloned the project, the key will not be set in the new <code>.env</code> file.</p>
        <pre><code>php artisan key:generate</code></pre>

        <li><strong>Run Migrations and Seeders:</strong></li>
        <p>Set up your database tables and populate them with initial data if necessary.</p>
        <pre><code>php artisan migrate</code></pre>
        <pre><code>php artisan db:seed</code></pre>
        <p>Note: Be careful when running migrations on an existing database.</p>
        
        <li><strong>Clear Caches:</strong></li>
        <p>Always a good idea to clear old cache files.</p>
        <pre><code>php artisan cache:clear</code></pre>
        <pre><code>php artisan config:cache</code></pre>
        <pre><code>php artisan route:cache</code></pre>
        <pre><code>php artisan view:cache</code></pre>
    </ol>

    <h2>Step 4: Web Server Configuration (Virtual Host)</h2>
    <p>This is where you tell your web server (Apache/Nginx) where to find your Laravel application's public directory.</p>
    <h3>Apache Example:</h3>
    <p>Create a new virtual host file (e.g., <code>/etc/apache2/sites-available/your_domain.conf</code>).</p>
    <pre><code>
&lt;VirtualHost *:80&gt;
    ServerName your_test_domain.com
    ServerAlias www.your_test_domain.com
    DocumentRoot /var/www/your_project_name/public

    &lt;Directory /var/www/your_project_name/public&gt;
        AllowOverride All
        Require all granted
    &lt;/Directory&gt;

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
    </code></pre>
    <p>Enable the site and restart Apache.</p>
    <pre><code>sudo a2ensite your_domain.conf
sudo systemctl restart apache2</code></pre>
    <p>Ensure the <code>mod_rewrite</code> module is enabled: <code>sudo a2enmod rewrite</code></p>

    <h3>Nginx Example:</h3>
    <p>Create a new server block file (e.g., <code>/etc/nginx/sites-available/your_domain.conf</code>).</p>
    <pre><code>
server {
    listen 80;
    server_name your_test_domain.com www.your_test_domain.com;
    root /var/www/your_project_name/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Content-Type-Options "nosniff";

    index index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock; # Adjust PHP version
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
    </code></pre>
    <p>Create a symlink to enable the site and restart Nginx.</p>
    <pre><code>sudo ln -s /etc/nginx/sites-available/your_domain.conf /etc/nginx/sites-enabled/
sudo systemctl restart nginx</code></pre>
    <p>Make sure to adjust the <code>fastcgi_pass</code> path to match your PHP-FPM socket version.</p>

    <h2>Step 5: Permissions</h2>
    <p>Laravel needs write access to the <code>storage</code> and <code>bootstrap/cache</code> directories. A common mistake is to skip this step, which leads to errors.</p>
    <pre><code>sudo chown -R www-data:www-data /var/www/your_project_name
sudo chmod -R 775 /var/www/your_project_name/storage
sudo chmod -R 775 /var/www/your_project_name/bootstrap/cache</code></pre>
    <p>Replace <code>www-data</code> with the user that your web server runs as (e.g., <code>nginx</code>, <code>apache</code>).</p>

    <h2>Step 6: Final Steps and Troubleshooting</h2>
    <ul>
        <li><strong>DNS:</strong> Point your domain's A record to your server's IP address. For a test server, you might just be accessing it via the IP.</li>
        <li><strong>Firewall:</strong> Ensure port 80 (and 443 for HTTPS) is open on your server's firewall (e.g., <code>ufw allow 'Apache Full'</code>).</li>
        <li><strong>Check Logs:</strong> If you encounter a blank page or an error, check the web server logs (e.g., <code>/var/log/apache2/error.log</code> or <code>/var/log/nginx/error.log</code>) and the Laravel logs (<code>storage/logs/laravel.log</code>).</li>
        <li><strong>Cache Issues:</strong> If changes don't seem to take effect, try clearing all caches again with <code>php artisan cache:clear</code> and <code>php artisan config:clear</code>.</li>
    </ul>

</div>

</body>
</html>